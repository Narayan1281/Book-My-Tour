{"mappings":"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","sources":["<anon>","public/js/index.js","public/js/mapbox.js","public/js/login.js","public/js/alerts.js","public/js/updateSettings.js","public/js/resetPassword.js","public/js/stripe.js"],"sourcesContent":["// import '@babel/polyfill'; // old version support for some js\nconst $31f182697195f68f$export$4c5dd147b21b9176 = (locations)=>{\n    mapboxgl.accessToken = \"pk.eyJ1IjoicnVzdGFtLW5hcmF5YW4iLCJhIjoiY2xsZGVzYXlwMGExNDNkbjE1dmp2OW5hMSJ9.hPd2zmsCK-bEWCw6FcMfew\";\n    var map = new mapboxgl.Map({\n        container: \"map\",\n        style: \"mapbox://styles/rustam-narayan/clldqixxc00zg01ph9nog22qm\",\n        scrollZoom: false\n    });\n    const bounds = new mapboxgl.LngLatBounds();\n    locations.forEach((loc)=>{\n        // Create marker\n        const el = document.createElement(\"div\");\n        el.className = \"marker\";\n        // Add marker\n        new mapboxgl.Marker({\n            element: el,\n            anchor: \"bottom\"\n        }).setLngLat(loc.coordinates).addTo(map);\n        // Add popup\n        new mapboxgl.Popup({\n            offset: 30\n        }).setLngLat(loc.coordinates).setHTML(`<p>Day ${loc.day}: ${loc.description}</p>`).addTo(map);\n        // Extend map bounds to include current location\n        bounds.extend(loc.coordinates);\n    });\n    // check documentation for adding more information and styling to the map\n    map.fitBounds(bounds, {\n        padding: {\n            top: 200,\n            bottom: 150,\n            left: 100,\n            right: 100\n        }\n    });\n};\n\n\n// import axios from \"axios\"; // importing from npm package simply won't work\n// however using CDN link works fine!\n// type is 'success' or 'error'\nconst $5c1b0cddcdce5e8e$export$516836c6a9dfc573 = ()=>{\n    const el = document.querySelector(\".alert\");\n    if (el) el.parentElement.removeChild(el); // tricky DOM manupulation\n};\nconst $5c1b0cddcdce5e8e$export$de026b00723010c1 = (type, msg, time = 3)=>{\n    $5c1b0cddcdce5e8e$export$516836c6a9dfc573();\n    const markup = `<div class=\"alert alert--${type}\">${msg}</div>`;\n    document.querySelector(\"body\").insertAdjacentHTML(\"afterbegin\", markup);\n    // afterbegin ---> insert in the starting of body element\n    window.setTimeout($5c1b0cddcdce5e8e$export$516836c6a9dfc573, time * 1000); // hide after 3s\n};\n\n\nconst $e466156f4c41845f$export$7200a869094fec36 = async (data)=>{\n    try {\n        const res = await axios({\n            method: \"POST\",\n            url: \"/api/v1/users/signup\",\n            data: data,\n            withCredentials: true\n        });\n        if (res.data.status === \"success\") (0, $5c1b0cddcdce5e8e$export$de026b00723010c1)(\"success\", \"User registration successfull! Please check your email and activate your account!\", 5);\n    // console.log(res);\n    } catch (err) {\n        (0, $5c1b0cddcdce5e8e$export$de026b00723010c1)(\"error\", err.response.data.message);\n    }\n};\nconst $e466156f4c41845f$export$596d806903d1f59e = async (email, password)=>{\n    try {\n        const res = await axios({\n            method: \"POST\",\n            url: \"/api/v1/users/login\",\n            data: {\n                email: email,\n                password: password\n            },\n            withCredentials: true\n        });\n        if (res.data.status === \"success\") {\n            (0, $5c1b0cddcdce5e8e$export$de026b00723010c1)(\"success\", \"Logged in successfully!\");\n            window.setTimeout(()=>{\n                location.assign(\"/\");\n            }, 1500); // refresh after 1500 ms\n        }\n    // console.log(res);\n    } catch (err) {\n        (0, $5c1b0cddcdce5e8e$export$de026b00723010c1)(\"error\", err.response.data.message);\n    }\n};\nconst $e466156f4c41845f$export$a0973bcfe11b05c9 = async ()=>{\n    try {\n        const res = await axios({\n            method: \"GET\",\n            url: \"/api/v1/users/logout\"\n        });\n        // it's an ajax request so the reload has to be done \n        // from client side\n        // if(res.data.status = 'success') location.reload(true); // reload from server (not cache!)\n        if (res.data.status === \"success\") {\n            (0, $5c1b0cddcdce5e8e$export$de026b00723010c1)(\"success\", \"Logged out successfully!\");\n            window.setTimeout(()=>{\n                location.assign(\"/login\");\n            }, 1500); // refresh after 1500 ms\n        }\n    } catch (err) {\n        (0, $5c1b0cddcdce5e8e$export$de026b00723010c1)(\"error\", \"Error logging out! Try again.\");\n    }\n};\n\n\n\nconst $3843a6bc3071435b$export$f558026a994b6051 = async (data, type)=>{\n    try {\n        const urlEndPoint = type === \"password\" ? \"updateMyPassword\" : \"updateMe\";\n        const res = await axios({\n            method: \"PATCH\",\n            url: `/api/v1/users/${urlEndPoint}`,\n            data: data\n        });\n        if (res.data.status === \"success\") {\n            (0, $5c1b0cddcdce5e8e$export$de026b00723010c1)(\"success\", `${type.toUpperCase()} updated successfully!`);\n            window.setTimeout(function() {\n                window.location.reload(true); // you can pass true to reload function to ignore the client cache and reload from the server\n            }, 1400);\n        // location.reload(true);  // we'll do it in later stage\n        }\n    } catch (err) {\n        (0, $5c1b0cddcdce5e8e$export$de026b00723010c1)(\"error\", err.response.data.message);\n    }\n};\n\n\n\nconst $2b9590c2e047b1bd$export$32ad1e8a6cc73029 = async (email)=>{\n    try {\n        const res = await axios({\n            method: \"POST\",\n            url: \"api/v1/users/forgotPassword\",\n            data: {\n                email: email\n            }\n        });\n        if (res.data.status === \"success\") (0, $5c1b0cddcdce5e8e$export$de026b00723010c1)(\"success\", res.data.message, 15);\n    } catch (err) {\n        (0, $5c1b0cddcdce5e8e$export$de026b00723010c1)(\"error\", err.response.data.message, 15);\n    }\n};\nconst $2b9590c2e047b1bd$export$dc726c8e334dd814 = async (data)=>{\n    try {\n        const res = await axios({\n            method: \"PATCH\",\n            url: `api/v1/users/resetPassword/${data?.resetToken}`,\n            data: data\n        });\n        if (res.data.status === \"success\") (0, $5c1b0cddcdce5e8e$export$de026b00723010c1)(\"success\", \"Password reset successful! Login to book tours.\", 10);\n    } catch (err) {\n        (0, $5c1b0cddcdce5e8e$export$de026b00723010c1)(\"error\", err.response.data.message, 5);\n    }\n};\n\n\n\nconst $c6b38b6b1de4b63b$var$stripe = Stripe(\"pk_test_51Nkgm7SFwSrQFE24QttNl2B3jOAlwq6oY8YjFmXxG8igAT1jp25CnqXTJjhkP0Klzwwaeqs3Upxvau1YhAxEE4B100ljbVK2j1\");\nconst $c6b38b6b1de4b63b$export$8d5bdbf26681c0c2 = async (tourId)=>{\n    try {\n        // 1) Get checkout session from API\n        const session = await axios(`/api/v1/bookings/checkout-session/${tourId}`);\n        // console.log(session);\n        // 2) Create checkout form +charge credit card\n        await $c6b38b6b1de4b63b$var$stripe.redirectToCheckout({\n            sessionId: session.data.session.id\n        });\n    } catch (err) {\n        console.log(err);\n        (0, $5c1b0cddcdce5e8e$export$de026b00723010c1)(\"error\", err);\n    }\n};\n\n\n\n// DOM ELEMENTS\nconst $fa79da8abd1c9dd8$var$mapBox = document.getElementById(\"map\");\nconst $fa79da8abd1c9dd8$var$signUpForm = document.querySelector(\".form--signup\");\nconst $fa79da8abd1c9dd8$var$loginForm = document.querySelector(\".form--login\");\nconst $fa79da8abd1c9dd8$var$logOutBtn = document.querySelector(\".nav__el--logout\");\nconst $fa79da8abd1c9dd8$var$forgotPasswordForm = document.querySelector(\".form--identify\");\nconst $fa79da8abd1c9dd8$var$resetPasswordForm = document.querySelector(\".form--resetPassword\");\nconst $fa79da8abd1c9dd8$var$userDataForm = document.querySelector(\".form-user-data\");\nconst $fa79da8abd1c9dd8$var$userPasswordForm = document.querySelector(\".form-user-password\");\nconst $fa79da8abd1c9dd8$var$bookBtn = document.getElementById(\"book-tour\");\n// DELEGATION\nif ($fa79da8abd1c9dd8$var$mapBox) {\n    const locations = JSON.parse(document.getElementById(\"map\").dataset.locations);\n    (0, $31f182697195f68f$export$4c5dd147b21b9176)(locations);\n}\nif ($fa79da8abd1c9dd8$var$signUpForm) $fa79da8abd1c9dd8$var$signUpForm.addEventListener(\"submit\", (e)=>{\n    e.preventDefault();\n    let name = document.getElementById(\"first-name\").value;\n    const lastName = document.getElementById(\"last-name\").value;\n    if (lastName) name = name + \" \" + lastName;\n    const email = document.getElementById(\"email\").value;\n    const password = document.getElementById(\"password\").value;\n    const passwordConfirm = document.getElementById(\"password-confirm\").value;\n    // console.log(name, email, password, passwordConfirm);\n    (0, $e466156f4c41845f$export$7200a869094fec36)({\n        name: name,\n        email: email,\n        password: password,\n        passwordConfirm: passwordConfirm\n    });\n});\nif ($fa79da8abd1c9dd8$var$loginForm) $fa79da8abd1c9dd8$var$loginForm.addEventListener(\"submit\", (e)=>{\n    e.preventDefault();\n    const email = document.getElementById(\"email\").value;\n    const password = document.getElementById(\"password\").value;\n    (0, $e466156f4c41845f$export$596d806903d1f59e)(email, password);\n});\nif ($fa79da8abd1c9dd8$var$logOutBtn) $fa79da8abd1c9dd8$var$logOutBtn.addEventListener(\"click\", (0, $e466156f4c41845f$export$a0973bcfe11b05c9));\nif ($fa79da8abd1c9dd8$var$userDataForm) $fa79da8abd1c9dd8$var$userDataForm.addEventListener(\"submit\", (e)=>{\n    e.preventDefault();\n    const form = new FormData(); // recreating form programatically\n    form.append(\"name\", document.getElementById(\"name\").value);\n    form.append(\"email\", document.getElementById(\"email\").value);\n    form.append(\"photo\", document.getElementById(\"photo\").files[0]);\n    // console.log(form);\n    (0, $3843a6bc3071435b$export$f558026a994b6051)(form, \"data\");\n});\nif ($fa79da8abd1c9dd8$var$userPasswordForm) $fa79da8abd1c9dd8$var$userPasswordForm.addEventListener(\"submit\", async (e)=>{\n    e.preventDefault();\n    document.querySelector(\".btn--save-password\").textContent = \"Updating...\";\n    const passwordCurrent = document.getElementById(\"password-current\").value;\n    const password = document.getElementById(\"password\").value;\n    const passwordConfirm = document.getElementById(\"password-confirm\").value;\n    await (0, $3843a6bc3071435b$export$f558026a994b6051)({\n        passwordCurrent: passwordCurrent,\n        password: password,\n        passwordConfirm: passwordConfirm\n    }, \"password\");\n    document.querySelector(\".btn--save-password\").textContent = \"Save password\";\n    document.getElementById(\"password-current\").value = \"\";\n    document.getElementById(\"password\").value = \"\";\n    document.getElementById(\"password-confirm\").value = \"\";\n});\nif ($fa79da8abd1c9dd8$var$forgotPasswordForm) $fa79da8abd1c9dd8$var$forgotPasswordForm.addEventListener(\"submit\", (e)=>{\n    e.preventDefault();\n    const email = document.getElementById(\"email\").value;\n    // console.log(email);\n    (0, $2b9590c2e047b1bd$export$32ad1e8a6cc73029)(email);\n// document.getElementById('email').value = '';\n});\nif ($fa79da8abd1c9dd8$var$resetPasswordForm) $fa79da8abd1c9dd8$var$resetPasswordForm.addEventListener(\"submit\", (e)=>{\n    e.preventDefault();\n    const queryString = window.location.search;\n    const urlParams = new URLSearchParams(queryString);\n    const resetToken = urlParams.get(\"token\");\n    const password = document.getElementById(\"password\").value;\n    const passwordConfirm = document.getElementById(\"password-confirm\").value;\n    // console.log(password, passwordConfirm);\n    (0, $2b9590c2e047b1bd$export$dc726c8e334dd814)({\n        password: password,\n        passwordConfirm: passwordConfirm,\n        resetToken: resetToken\n    });\n});\nif ($fa79da8abd1c9dd8$var$bookBtn) $fa79da8abd1c9dd8$var$bookBtn.addEventListener(\"click\", (e)=>{\n    e.target.textContent = \"Processing...\";\n    const { tourId: tourId } = e.target.dataset; // dash separated names are by default converted into camel case, and thus we can use destructuring...\n    (0, $c6b38b6b1de4b63b$export$8d5bdbf26681c0c2)(tourId);\n});\nconst $fa79da8abd1c9dd8$var$alertMessage = document.querySelector(\"body\").dataset.alert;\nif ($fa79da8abd1c9dd8$var$alertMessage) (0, $5c1b0cddcdce5e8e$export$de026b00723010c1)(\"success\", $fa79da8abd1c9dd8$var$alertMessage, 10);\n\n\n//# sourceMappingURL=index.js.map\n","// import '@babel/polyfill'; // old version support for some js\r\nimport { displayMap } from './mapbox';\r\nimport { login, signup, logout } from './login';  \r\nimport { updateSettings } from './updateSettings';\r\nimport { sendResetLink, resetPassword } from './resetPassword';\r\nimport { bookTour } from './stripe';\r\nimport { showAlert } from './alerts';\r\n\r\n// DOM ELEMENTS\r\nconst mapBox = document.getElementById('map');\r\nconst signUpForm = document.querySelector('.form--signup');\r\nconst loginForm = document.querySelector('.form--login');\r\nconst logOutBtn = document.querySelector('.nav__el--logout');\r\nconst forgotPasswordForm = document.querySelector('.form--identify');\r\nconst resetPasswordForm = document.querySelector('.form--resetPassword');\r\nconst userDataForm = document.querySelector('.form-user-data');\r\nconst userPasswordForm = document.querySelector('.form-user-password');\r\nconst bookBtn = document.getElementById('book-tour');\r\n\r\n// DELEGATION\r\nif (mapBox) {\r\n    const locations = JSON.parse(document.getElementById('map').dataset.locations);\r\n    displayMap(locations);\r\n}\r\n\r\nif (signUpForm) {\r\n    signUpForm.addEventListener('submit', e => {\r\n        e.preventDefault();\r\n        let name = document.getElementById('first-name').value;\r\n        const lastName = document.getElementById('last-name').value;\r\n        if(lastName)\r\n            name = name + ' ' + lastName;\r\n        const email = document.getElementById('email').value;\r\n        const password = document.getElementById('password').value;\r\n        const passwordConfirm = document.getElementById('password-confirm').value;\r\n        // console.log(name, email, password, passwordConfirm);\r\n        signup({name, email, password, passwordConfirm});\r\n    }); \r\n}\r\n\r\nif (loginForm) {\r\n    loginForm.addEventListener('submit', e => {\r\n        e.preventDefault();\r\n        const email = document.getElementById('email').value;\r\n        const password = document.getElementById('password').value;\r\n        login(email, password);\r\n    }); \r\n}\r\n\r\nif (logOutBtn) {\r\n    logOutBtn.addEventListener('click', logout);\r\n}\r\n\r\nif (userDataForm)\r\n    userDataForm.addEventListener('submit', e => {\r\n        e.preventDefault();\r\n        const form = new FormData(); // recreating form programatically\r\n        form.append('name', document.getElementById('name').value);\r\n        form.append('email', document.getElementById('email').value);\r\n        form.append('photo', document.getElementById('photo').files[0]);\r\n        // console.log(form);\r\n\r\n        updateSettings( form, 'data');\r\n    });\r\n\r\nif (userPasswordForm)\r\n    userPasswordForm.addEventListener('submit', async e => {\r\n        e.preventDefault();\r\n        document.querySelector('.btn--save-password').textContent = 'Updating...'\r\n\r\n        const passwordCurrent = document.getElementById('password-current').value;\r\n        const password = document.getElementById('password').value;\r\n        const passwordConfirm = document.getElementById('password-confirm').value;\r\n        await updateSettings({ passwordCurrent, password, passwordConfirm }, 'password');\r\n        document.querySelector('.btn--save-password').textContent = 'Save password';\r\n        document.getElementById('password-current').value = '';\r\n        document.getElementById('password').value = '';\r\n        document.getElementById('password-confirm').value = '';\r\n    });\r\n\r\nif (forgotPasswordForm)\r\n{\r\n    forgotPasswordForm.addEventListener('submit', e => {\r\n        e.preventDefault();\r\n        const email = document.getElementById('email').value;\r\n        // console.log(email);\r\n        sendResetLink(email);\r\n        // document.getElementById('email').value = '';\r\n    })\r\n}\r\n\r\nif (resetPasswordForm)\r\n{\r\n    resetPasswordForm.addEventListener('submit', e => {\r\n        e.preventDefault();\r\n        const queryString = window.location.search;\r\n        const urlParams = new URLSearchParams(queryString);\r\n        const resetToken = urlParams.get('token');\r\n        const password = document.getElementById('password').value;\r\n        const passwordConfirm = document.getElementById('password-confirm').value;\r\n        // console.log(password, passwordConfirm);\r\n        resetPassword({password, passwordConfirm, resetToken});\r\n    })\r\n}\r\n\r\nif (bookBtn)\r\n    bookBtn.addEventListener('click', e => {\r\n        e.target.textContent = 'Processing...';\r\n        const { tourId } = e.target.dataset; // dash separated names are by default converted into camel case, and thus we can use destructuring...\r\n        bookTour(tourId);\r\n}); \r\n\r\nconst alertMessage = document.querySelector('body').dataset.alert;\r\nif (alertMessage) showAlert('success', alertMessage, 10);"," export const displayMap = locations => {\r\n    mapboxgl.accessToken = 'pk.eyJ1IjoicnVzdGFtLW5hcmF5YW4iLCJhIjoiY2xsZGVzYXlwMGExNDNkbjE1dmp2OW5hMSJ9.hPd2zmsCK-bEWCw6FcMfew';\r\n\r\n    var map = new mapboxgl.Map({\r\n        container: 'map',\r\n        style: 'mapbox://styles/rustam-narayan/clldqixxc00zg01ph9nog22qm',\r\n        scrollZoom: false\r\n        // center: [-118.113491, 34.111745],\r\n        // zoom: 10,\r\n        // interactive: false \r\n    });\r\n\r\n    const bounds = new mapboxgl.LngLatBounds();\r\n\r\n    locations.forEach(loc => {\r\n        // Create marker\r\n        const el = document.createElement('div');\r\n        el.className = 'marker';\r\n\r\n        // Add marker\r\n        new mapboxgl.Marker({\r\n            element: el,\r\n            anchor: 'bottom'\r\n        }).setLngLat(loc.coordinates).addTo(map);\r\n\r\n        // Add popup\r\n        new mapboxgl.Popup({\r\n            offset: 30\r\n        })\r\n        .setLngLat(loc.coordinates)\r\n        .setHTML(`<p>Day ${loc.day}: ${loc.description}</p>`)\r\n        .addTo(map);\r\n\r\n        // Extend map bounds to include current location\r\n        bounds.extend(loc.coordinates);\r\n    });\r\n\r\n    // check documentation for adding more information and styling to the map\r\n    map.fitBounds(bounds, {\r\n        padding: {\r\n            top: 200,\r\n            bottom: 150,\r\n            left: 100,\r\n            right: 100\r\n        }\r\n    });\r\n};","// import axios from \"axios\"; // importing from npm package simply won't work\r\n                            // however using CDN link works fine!\r\nimport { showAlert } from './alerts';\r\n\r\n// export modules in javaScript with ES6\r\n// node.js uses common js for export import functionality\r\n\r\nexport const signup = async (data) => {\r\n    try{\r\n        const res = await axios({\r\n            method: 'POST',\r\n            url: '/api/v1/users/signup', // since website and api are hosted on same server, hence relative path works\r\n            data,\r\n            withCredentials: true\r\n        });\r\n\r\n        if(res.data.status === 'success') {\r\n            showAlert('success', 'User registration successfull! Please check your email and activate your account!', 5);\r\n            // window.setTimeout(() => {\r\n            //     location.assign('/');\r\n            // }, 1500); // refresh after 1500 ms\r\n        }\r\n        // console.log(res);\r\n    } catch(err) {\r\n        showAlert('error', err.response.data.message);\r\n    }\r\n};\r\n\r\nexport const login = async (email, password) => {\r\n    try{\r\n        const res = await axios({\r\n            method: 'POST',\r\n            url: '/api/v1/users/login', // since website and api are hosted on same server, hence relative path works\r\n            data: {\r\n                email,\r\n                password\r\n            },\r\n            withCredentials: true\r\n        });\r\n\r\n        if(res.data.status === 'success') {\r\n            showAlert('success', 'Logged in successfully!');\r\n            window.setTimeout(() => {\r\n                location.assign('/');\r\n            }, 1500); // refresh after 1500 ms\r\n        }\r\n        // console.log(res);\r\n    } catch(err) {\r\n        showAlert('error', err.response.data.message);\r\n    }\r\n};\r\n\r\nexport const logout = async () => {\r\n    try {\r\n        const res = await axios({\r\n            method: 'GET',\r\n            url: '/api/v1/users/logout'\r\n        });\r\n        // it's an ajax request so the reload has to be done \r\n        // from client side\r\n        // if(res.data.status = 'success') location.reload(true); // reload from server (not cache!)\r\n        if(res.data.status === 'success') {\r\n            showAlert('success', 'Logged out successfully!');\r\n            window.setTimeout(() => {\r\n                location.assign('/login');\r\n            }, 1500); // refresh after 1500 ms\r\n        }\r\n    } catch (err){\r\n        showAlert('error', 'Error logging out! Try again.');\r\n    }\r\n};","// type is 'success' or 'error'\r\nexport const hideAlert = () => {\r\n    const el = document.querySelector('.alert');\r\n    if (el) el.parentElement.removeChild(el); // tricky DOM manupulation\r\n};\r\n\r\nexport const showAlert = (type, msg, time = 3) => {\r\n    hideAlert();\r\n    const markup = `<div class=\"alert alert--${type}\">${msg}</div>`;\r\n    document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\r\n    // afterbegin ---> insert in the starting of body element\r\n    window.setTimeout(hideAlert, time * 1000); // hide after 3s\r\n};","import { showAlert } from \"./alerts\";\r\n\r\n// type is either 'password' or 'data'\r\nexport const updateSettings = async (data, type) => {\r\n    try {\r\n        const urlEndPoint = type === 'password' ? 'updateMyPassword' : 'updateMe';\r\n        const res = await axios({\r\n            method: 'PATCH',\r\n            url: `/api/v1/users/${urlEndPoint}`,\r\n            data \r\n        });\r\n\r\n        if(res.data.status === 'success') {\r\n            showAlert('success', `${type.toUpperCase()} updated successfully!`);\r\n            window.setTimeout(function(){\r\n                window.location.reload(true); // you can pass true to reload function to ignore the client cache and reload from the server\r\n            },1400); \r\n            // location.reload(true);  // we'll do it in later stage\r\n        }\r\n    } catch (err) {\r\n        showAlert('error', err.response.data.message);\r\n    }\r\n};","import { showAlert } from './alerts';\r\n\r\nexport const sendResetLink = async (email) => {\r\n    try {\r\n        const res = await axios({\r\n            method: 'POST',\r\n            url: 'api/v1/users/forgotPassword',\r\n            data: { email }\r\n        });\r\n\r\n        if(res.data.status === 'success') {\r\n            showAlert('success', res.data.message, 15);\r\n        }\r\n    } catch (err) {\r\n        showAlert('error', err.response.data.message, 15);\r\n    }\r\n};\r\n\r\nexport const resetPassword = async (data) => {\r\n    try {\r\n        const res = await axios({\r\n            method: 'PATCH',\r\n            url: `api/v1/users/resetPassword/${data?.resetToken}`,\r\n            data\r\n        });\r\n\r\n        if(res.data.status === 'success') {\r\n            showAlert('success', \"Password reset successful! Login to book tours.\", 10);\r\n        }\r\n\r\n    } catch (err) {\r\n        showAlert('error', err.response.data.message, 5);\r\n    }\r\n}","import { showAlert } from \"./alerts\";\r\n\r\nconst stripe = Stripe('pk_test_51Nkgm7SFwSrQFE24QttNl2B3jOAlwq6oY8YjFmXxG8igAT1jp25CnqXTJjhkP0Klzwwaeqs3Upxvau1YhAxEE4B100ljbVK2j1');\r\n\r\nexport const bookTour = async tourId => {\r\n    try {\r\n        // 1) Get checkout session from API\r\n        const session = await axios(`/api/v1/bookings/checkout-session/${tourId}`);\r\n        // console.log(session);\r\n\r\n        // 2) Create checkout form +charge credit card\r\n        await stripe.redirectToCheckout({\r\n            sessionId: session.data.session.id\r\n        });\r\n    } catch (err) {\r\n        console.log(err);\r\n        showAlert('error', err);\r\n    }\r\n};"],"names":["$5c1b0cddcdce5e8e$export$516836c6a9dfc573","el","document","querySelector","parentElement","removeChild","$5c1b0cddcdce5e8e$export$de026b00723010c1","type","msg","time","markup","insertAdjacentHTML","window","setTimeout","$e466156f4c41845f$export$7200a869094fec36","data","res","axios","method","url","withCredentials","status","err","response","message","$e466156f4c41845f$export$596d806903d1f59e","email","password","location","assign","$e466156f4c41845f$export$a0973bcfe11b05c9","$3843a6bc3071435b$export$f558026a994b6051","toUpperCase","reload","$2b9590c2e047b1bd$export$32ad1e8a6cc73029","$2b9590c2e047b1bd$export$dc726c8e334dd814","resetToken","$c6b38b6b1de4b63b$var$stripe","Stripe","$c6b38b6b1de4b63b$export$8d5bdbf26681c0c2","tourId","session","redirectToCheckout","sessionId","id","console","log","$fa79da8abd1c9dd8$var$mapBox","getElementById","$fa79da8abd1c9dd8$var$signUpForm","$fa79da8abd1c9dd8$var$loginForm","$fa79da8abd1c9dd8$var$logOutBtn","$fa79da8abd1c9dd8$var$forgotPasswordForm","$fa79da8abd1c9dd8$var$resetPasswordForm","$fa79da8abd1c9dd8$var$userDataForm","$fa79da8abd1c9dd8$var$userPasswordForm","$fa79da8abd1c9dd8$var$bookBtn","locations","JSON","parse","dataset","mapboxgl","accessToken","map","Map","container","style","scrollZoom","bounds","LngLatBounds","forEach","loc","createElement","className","Marker","element","anchor","setLngLat","coordinates","addTo","Popup","offset","setHTML","day","description","extend","fitBounds","padding","top","bottom","left","right","addEventListener","e","preventDefault","name","value","lastName","passwordConfirm","form","FormData","append","files","textContent","passwordCurrent","queryString","search","urlParams","URLSearchParams","get","target","$fa79da8abd1c9dd8$var$alertMessage","alert"],"version":3,"file":"index.js.map","sourceRoot":"../../../"}